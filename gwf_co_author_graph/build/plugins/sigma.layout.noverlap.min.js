!function(n){"use strict";if("undefined"==typeof sigma)throw new Error("sigma is not declared");sigma.utils.pkg("sigma.layout.noverlap");var s={speed:3,scaleNodes:1.2,nodeMargin:5,gridSize:20,permittedExpansion:1.1,rendererIndex:0,maxIterations:500},t={},o={};function e(){var N=this;this.init=function(n,i){if(i=i||{},this.sigInst=n,this.config=sigma.utils.extend(i,s),this.easing=i.easing,this.duration=i.duration,i.nodes&&(this.nodes=i.nodes,delete i.nodes),!sigma.plugins||void 0===sigma.plugins.animate)throw new Error("sigma.plugins.animate is not declared");this.running=!1},this.atomicGo=function(){if(!this.running||this.iterCount<1)return!1;var n,i,o,e,d,s,t,r,g,a,f,c,h,l,u,p,x,_,m,M=this.nodes||this.sigInst.graph.nodes(),y=M.length,z=1/0,v=-1/0,I=1/0,E=-1/0;for(this.iterCount--,this.running=!1,n=0;n<y;n++)(i=M[n]).dn.dx=0,i.dn.dy=0,z=Math.min(z,i.dn_x-(i.dn_size*N.config.scaleNodes+N.config.nodeMargin)),v=Math.max(v,i.dn_x+(i.dn_size*N.config.scaleNodes+N.config.nodeMargin)),I=Math.min(I,i.dn_y-(i.dn_size*N.config.scaleNodes+N.config.nodeMargin)),E=Math.max(E,i.dn_y+(i.dn_size*N.config.scaleNodes+N.config.nodeMargin));for(z=(s=(z+v)/2)-N.config.permittedExpansion*(e=v-z)/2,v=s+N.config.permittedExpansion*e/2,I=(s=(I+E)/2)-N.config.permittedExpansion*(d=E-I)/2,E=s+N.config.permittedExpansion*d/2,t={},r=0;r<N.config.gridSize;r++)for(t[r]={},g=0;g<N.config.gridSize;g++)t[r][g]=[];for(n=0;n<y;n++)for(p=(i=M[n]).dn_x-(i.dn_size*N.config.scaleNodes+N.config.nodeMargin),x=i.dn_x+(i.dn_size*N.config.scaleNodes+N.config.nodeMargin),_=i.dn_y-(i.dn_size*N.config.scaleNodes+N.config.nodeMargin),m=i.dn_y+(i.dn_size*N.config.scaleNodes+N.config.nodeMargin),p=Math.floor(N.config.gridSize*(p-z)/(v-z)),a=Math.floor(N.config.gridSize*(x-z)/(v-z)),f=Math.floor(N.config.gridSize*(_-I)/(E-I)),c=Math.floor(N.config.gridSize*(m-I)/(E-I)),g=p;g<=a;g++)for(r=f;r<=c;r++)t[r][g].push(i.id);for(h={},r=0;r<N.config.gridSize;r++)for(g=0;g<N.config.gridSize;g++)t[r][g].forEach(function(i){for(h[i]||(h[i]=[]),l=Math.max(0,r-1);l<=Math.min(r+1,N.config.gridSize-1);l++)for(u=Math.max(0,g-1);u<=Math.min(g+1,N.config.gridSize-1);u++)t[l][u].forEach(function(n){n!==i&&-1===h[i].indexOf(n)&&h[i].push(n)})});for(n=0;n<y;n++)o=M[n],h[o.id].forEach(function(n){var i=N.sigInst.graph.nodes(n),s=i.dn_x-o.dn_x,t=i.dn_y-o.dn_y,n=Math.sqrt(s*s+t*t);n<o.dn_size*N.config.scaleNodes+N.config.nodeMargin+(i.dn_size*N.config.scaleNodes+N.config.nodeMargin)&&(N.running=!0,0<n?(i.dn.dx+=s/n*(1+o.dn_size),i.dn.dy+=t/n*(1+o.dn_size)):(i.dn.dx+=.01*e*(.5-Math.random()),i.dn.dy+=.01*d*(.5-Math.random())))});for(n=0;n<y;n++)(i=M[n]).fixed||(i.dn_x=i.dn_x+.1*i.dn.dx*N.config.speed,i.dn_y=i.dn_y+.1*i.dn.dy*N.config.speed);return this.running&&this.iterCount<1&&(this.running=!1),this.running},this.go=function(){for(this.iterCount=this.config.maxIterations;this.running;)this.atomicGo();this.stop()},this.start=function(){if(!this.running){var n=this.sigInst.graph.nodes(),i=this.sigInst.renderers[N.config.rendererIndex].options.prefix;this.running=!0;for(var s=0;s<n.length;s++)n[s].dn_x=n[s][i+"x"],n[s].dn_y=n[s][i+"y"],n[s].dn_size=n[s][i+"size"],n[s].dn={dx:0,dy:0};o[N.sigInst.id].dispatchEvent("start"),this.go()}},this.stop=function(){var i=this.sigInst.graph.nodes();if(this.running=!1,this.easing)o[N.sigInst.id].dispatchEvent("interpolate"),sigma.plugins.animate(N.sigInst,{x:"dn_x",y:"dn_y"},{easing:N.easing,onComplete:function(){N.sigInst.refresh();for(var n=0;n<i.length;n++)i[n].dn=null,i[n].dn_x=null,i[n].dn_y=null;o[N.sigInst.id].dispatchEvent("stop")},duration:N.duration});else{for(var n=0;n<i.length;n++)i[n].x=i[n].dn_x,i[n].y=i[n].dn_y;this.sigInst.refresh();for(n=0;n<i.length;n++)i[n].dn=null,i[n].dn_x=null,i[n].dn_y=null;o[N.sigInst.id].dispatchEvent("stop")}},this.kill=function(){this.sigInst=null,this.config=null,this.easing=null}}sigma.prototype.configNoverlap=function(n){var i=this;if(!n)throw new Error('Missing argument: "config"');return t[i.id]||(t[i.id]=new e,o[i.id]={},sigma.classes.dispatcher.extend(o[i.id]),i.bind("kill",function(){t[i.id].kill(),t[i.id]=null,o[i.id]=null})),t[i.id].init(i,n),o[i.id]},sigma.prototype.startNoverlap=function(n){var i=this;return n&&this.configNoverlap(i,n),t[i.id].start(),o[i.id]},sigma.prototype.isNoverlapRunning=function(){return!!t[this.id]&&t[this.id].running}}.call(this);